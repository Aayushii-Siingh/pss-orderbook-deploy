pipeline {
    agent {
        node {
            label 'generic-agent'
        }
    }
    stages {
        stage('Check Dev Website') {
            steps {
                script {
                    sh """
                    curl "https://${COHORT}${TEAM}dev.computerlab.online/"
                    """
                }
            }
        }
	stage('Search Most Recent Image Version') {
	    steps{
	        script{
	            sh """
			curl "http://ecrlist-ps.computerlab.online/index.php" | grep -Eo "(${cohort}${team}(fe|db|api)-dev-[0-9]*)"
			sort -nro testOutput.txt testOutput.txt
			echo "Latest FE Version: " $(grep fe -m1 testOutput.txt || { echo 'fe image not found';exit 1; })
			echo "Latest DB Version: " $(grep db -m1 testOutput.txt || { echo 'db image not found';exit 1; })
			echo "Latest API Version: " $(grep api -m1 testOuput.txt || { echo 'api image not found';exit 1; })
	            """
	      	}
	    }
        }
    }
}
